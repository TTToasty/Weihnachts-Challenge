<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>North Pole Customer Happiness Hotline</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      background: radial-gradient(circle at top, #AD5F5A 0, #8A2724 45%, #330F0C 100%);
      color: #222;
      padding: 9rem 1rem;
    }

    .ueberschrift {
      font-size: 2.0rem;
      font-weight: bold;
      text-align: center;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      margin-bottom: 1.5rem;
    }

    .card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 18px;
      padding: 24px 26px;
      width: 90vw;
      max-width: 600px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.35);
      margin: auto
    }

    h1 {
      margin-top: 0;
      text-align: center;
      font-size: 1.6rem;
    }

    label, select, input {
      display: block;
      width: 100%;
      margin-top: 10px;
      font-size: 1rem;
      padding: 8px;
    }

    .anzeige {
      margin-top: 16px;
      text-align: center;
      font-weight: bold;
      font-size: 1.1rem;
    }

    .bar-outer {
      width: 100%;
      height: 26px;
      border-radius: 999px;
      background: #eeeeee;
      overflow: hidden;
      margin-top: 10px;
      box-shadow: inset 0 0 4px rgba(0, 0, 0, 0.2);
    }

    .bar-inner {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #b71c1c, #f44336, #ffb300);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: width 0.4s ease, background 0.4s ease;
      color: #fff;
      font-weight: 700;
      font-size: 0.9rem;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    .btn {
      margin-top: 18px;
      background: #2e7d32;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 999px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
    }

    .snowflake {
      position: fixed;
      top: -2rem;
      color: #fff;
      font-size: 1.2rem;
      animation: fall linear infinite;
      pointer-events: none;
      z-index: 9999;
    }

    @keyframes fall {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(180deg);
        opacity: 0;
      }
    }

    
  </style>
</head>
<body>
  <div class="ueberschrift">ðŸŽ„ North Pole Customer Happiness Hotline ðŸŽ„</div>
  
  <div class="card" id="auswahl">
    <h1>WÃ¤hle dein Team</h1>
    
    <select id="teamSelect">
      <option value="" >Bitte auswÃ¤hlen</option>
      <option value="A">Schneeflockensupport</option>
      <option value="B">Rentier-Hotline</option>
      <option value="C">Wunschlisten-Management</option>
      <option value="D">Lebkuchen-LÃ¶sungen</option>
      <option value="E">Elfen-Eskalationsstelle</option>
      <option value="F">Geschenketracking</option>
      <option value="G">Kekskontrolle</option>
      <option value="H">Schlitten-Backoffice</option>
    </select>
    <button class="btn" onclick="startTeam()">Weiter</button>
    <button class="btn" onclick="zeigeUebersicht()">Zur Ãœbersicht</button>

  </div>

  <div class="card" id="app" style="display: none;">
    <h1 id="teamTitel">Team</h1>

    <div class="anzeige" id="ergebnis">Gib deine LÃ¶sung ein!</div>

    <div class="bar-outer">
      <div class="bar-inner" id="stressbalken">100%</div>
    </div>

    <label for="fall">Fall-Nummer:</label>
    <select id="fall">
      <option value="" >Bitte auswÃ¤hlen</option>
      <option value="1">Chaos in der Poststelle</option>
      <option value="2">Paketverlagerung</option>
      <option value="3">In der Werkstatt</option>
      <option value="4">Fall 4</option>
    </select>

    <label for="lÃ¶sung">LÃ¶sung:</label>
    <input type="text" id="lÃ¶sung">

    <button class="btn" onclick="checkLÃ¶sung()">LÃ¶sung prÃ¼fen</button>
    <button class="btn" onclick="zurueckZurAuswahl()" style="margin-top: 1.5rem;">ZurÃ¼ck</button>
  </div>

  <div class="card" id="uebersicht" style="display: none; margin-top: 2rem;">
  <h1 style="text-align: center;">Aktueller RÃ¼ckstau aller Teams</h1>
  <div id="balkenContainer"></div>
  <button class="btn" onclick="zurueckZurAuswahl()" style="margin-top: 1.5rem;">ZurÃ¼ck</button>
</div>

    
    <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore-compat.js"></script>

<script>
  
  const firebaseConfig = {
      apiKey: "AIzaSyA5XYxLTaS89XTwSXReX6TAlK5wUfDC0Fc",
      authDomain: "weihnachts-challenge-e8829.firebaseapp.com",
      projectId: "weihnachts-challenge-e8829",
      storageBucket: "weihnachts-challenge-e8829.firebasestorage.app",
      messagingSenderId: "169921346552",
      appId: "1:169921346552:web:f860f9564bb49033dfb40d"
    };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore()
  
    
    const lÃ¶sungsdaten = {
      "1": { lÃ¶sung: "timmy", stress: 25 },
      "2": { lÃ¶sung: "leise rieselt der schnee", stress: 25 },
      "3": { lÃ¶sung: "elfe", stress: 25 },
      "4": { lÃ¶sung: "keks", stress: 25 }
    };

    let aktuellesTeam = "";
    let aktuellerStress = 100;
    let erledigteFaelle = new Set();

    document.getElementById("lÃ¶sung").addEventListener("keydown", function(event) {
      if (event.key === "Enter") {
      event.preventDefault();
      checkLÃ¶sung();
    }
  });

    
    function startTeam() {
      const team = document.getElementById("teamSelect").value;
      const teamText = document.getElementById("teamSelect").selectedOptions[0].text;
      if (!team) return;

      aktuellesTeam = team;

      db.collection("teams").doc(team).get().then((doc) => {
  if (doc.exists) {
    const data = doc.data();
    aktuellerStress = data.stress ?? 100;
    erledigteFaelle = new Set(data.erledigt ?? []);
  } else {
    aktuellerStress = 100;
    erledigteFaelle = new Set();
  }
  document.getElementById("teamTitel").textContent = teamText;
  document.getElementById("auswahl").style.display = "none";
  document.getElementById("app").style.display = "block";
  updateStress(0);
});
  
      document.getElementById("teamTitel").textContent = teamText;

      document.getElementById("auswahl").style.display = "none";
      document.getElementById("app").style.display = "block";
      updateStress(0);
    }

    function updateStress(reduzierung) {
      aktuellerStress = Math.max(0, aktuellerStress - reduzierung);
      const balken = document.getElementById("stressbalken");
      balken.style.width = aktuellerStress + "%";
      balken.textContent = aktuellerStress + "%";

      if (aktuellerStress === 0) {
        ergebnis.textContent = "ðŸŽ‰ Geschafft! Der RÃ¼ckstau ist beseitigt. ðŸŽ„ðŸ§™â€â™‚ï¸";
    }

      if (aktuellerStress > 70) {
        balken.style.background = "linear-gradient(90deg, #b71c1c, #f44336, #ffb300)";
      } else if (aktuellerStress > 40) {
        balken.style.background = "linear-gradient(90deg, #f57c00, #ffb300, #ffee58)";
      } else {
        balken.style.background = "linear-gradient(90deg, #388e3c, #66bb6a, #a5d6a7)";
      }
    }

    function checkLÃ¶sung() {
      const fall = document.getElementById("fall").value;
      const eingabe = document.getElementById("lÃ¶sung").value.trim().toLowerCase();
      const daten = lÃ¶sungsdaten[fall];
      const ergebnis = document.getElementById("ergebnis");

      if (!daten) {
        ergebnis.textContent = "Bitte Fall auswÃ¤hlen!";
        return;
      }

      const schlÃ¼ssel = `${aktuellesTeam}-${fall}`;

      if (erledigteFaelle.has(schlÃ¼ssel)) {
        document.getElementById("lÃ¶sung").value = "";
        ergebnis.textContent = "Dieser Fall wurde bereits gelÃ¶st.";
        return;
      }

      if (eingabe === daten.lÃ¶sung) {
        ergebnis.textContent = `Richtig! RÃ¼ckstau sinkt um ${daten.stress}%.`;
        erledigteFaelle.add(schlÃ¼ssel);
        updateStress(daten.stress);
        document.getElementById("lÃ¶sung").value = "";
        // Speichern in Firebase
        db.collection("teams").doc(aktuellesTeam).set({
          stress: aktuellerStress,
          erledigt: Array.from(erledigteFaelle)
        });
      } else {
        ergebnis.textContent = "Falsche LÃ¶sung.";
        document.getElementById("lÃ¶sung").value = "";
      }
    }

  function ladeUebersicht() {
  const container = document.getElementById("uebersicht");
  const balkenContainer = document.getElementById("balkenContainer");
  balkenContainer.innerHTML = "";

  // Liste aller bekannten Teams
  const bekannteTeams = {
    A: "Schneeflockensupport",
    B: "Rentier-Hotline",
    C: "Wunschlisten-Management",
    D: "Lebkuchen-LÃ¶sungen",
    E: "Elfen-Eskalationsstelle",
    F: "Geschenketracking",
    G: "Kekskontrolle",
    H: "Schlitten-Backoffice"
  };

  // Alle EintrÃ¤ge aus der Datenbank holen
  db.collection("teams").get().then(snapshot => {
    const gespeicherteTeams = {};
    
    snapshot.forEach(doc => {
      gespeicherteTeams[doc.id] = doc.data();
    });

    // Alle bekannten Teams durchgehen
    Object.entries(bekannteTeams).forEach(([key, name]) => {
      let daten = gespeicherteTeams[key];

      // Wenn es den Eintrag noch nicht gibt â†’ anlegen mit 100 %
      if (!daten) {
        daten = { stress: 100, erledigt: [] };
        db.collection("teams").doc(key).set(daten);
      }

      const stress = daten.stress ?? 100;

      const teamDiv = document.createElement("div");
      teamDiv.style.marginBottom = "1rem";

      const label = document.createElement("div");
      label.textContent = name;
      label.style.marginBottom = "0.3rem";
      label.style.fontWeight = "bold";

      const outer = document.createElement("div");
      outer.className = "bar-outer";

      const inner = document.createElement("div");
      inner.className = "bar-inner";
      inner.style.width = stress + "%";
      inner.textContent = stress + "%";

      if (stress > 70) {
        inner.style.background = "linear-gradient(90deg, #b71c1c, #f44336, #ffb300)";
      } else if (stress > 40) {
        inner.style.background = "linear-gradient(90deg, #f57c00, #ffb300, #ffee58)";
      } else {
        inner.style.background = "linear-gradient(90deg, #388e3c, #66bb6a, #a5d6a7)";
      }

      outer.appendChild(inner);
      teamDiv.appendChild(label);
      teamDiv.appendChild(outer);
      balkenContainer.appendChild(teamDiv);
    });

    container.style.display = "block";
  });
}

  function zeigeUebersicht() {
  document.getElementById("auswahl").style.display = "none";
  document.getElementById("app").style.display = "none";
  document.getElementById("uebersicht").style.display = "block";
  ladeUebersicht();
}

 function zurueckZurAuswahl() {
  document.getElementById("uebersicht").style.display = "none";
  document.getElementById("app").style.display = "none";
  document.getElementById("auswahl").style.display = "block";
}

  function erstelleSchneeflocke() {
  const schneeflocke = document.createElement("div");
  schneeflocke.classList.add("snowflake");
  const emojis = ["â„ï¸", "ðŸŽ„", "â˜ƒï¸", "âœ¨", "ðŸŽ", "â­", "ðŸ¦Œ", "ðŸª"];
schneeflocke.textContent = emojis[Math.floor(Math.random() * emojis.length)];


  // ZufÃ¤llige Position und GrÃ¶ÃŸe
  schneeflocke.style.left = Math.random() * 100 + "vw";
  schneeflocke.style.fontSize = (Math.random() * 12 + 12) + "px";
  schneeflocke.style.animationDuration = (Math.random() * 7 + 5) + "s";

  document.body.appendChild(schneeflocke);

  setTimeout(() => {
    schneeflocke.remove();
  }, 5000); // entfernt die Flocke nach 5 Sekunden
}

// Alle 200â€“400ms eine neue Schneeflocke
setInterval(erstelleSchneeflocke, 300);

  
  </script>
  
</body>
</html>

